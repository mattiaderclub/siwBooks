<!DOCTYPE html>
<html>

<head>
	<title>Ricerca Avanzata Libri</title>
	<link rel="stylesheet" href="/css/stile-tema-libri.css?version=2" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>

<body>
	<header class="main-header">
		<div class="header-content container">
			<!-- A sinistra -->
			<div class="brand-section">
				<a href="/"><img src="/images/logo-siwBooks.png" class="brand-logo" alt="SiwBooks Logo" /></a>
				<h1 class="brand-title">SiwBooks</h1>
			</div>

			<!-- A destra -->
			<div class="user-section">
				<div class="user-info">
					<span class="user-role" th:if="${credentials != null}">
						<span th:if="${credentials.role == 'DEFAULT'}">Cliente:</span>
						<span th:if="${credentials.role == 'ADMIN'}">Bibliotecario:</span>
					</span>
					<span class="user-name" th:if="${userDetails}" th:text="${userDetails.username}"></span>
				</div>
				<div class="header-actions">
					<a class="btn-profile" th:if="${credentials != null}"
						th:href="@{/utente/{id}/profilo(id=${credentials.user.id})}">
						<i class="fas fa-user"></i>
						Profilo
					</a>
					<a class="btn-logout" href="/logout" th:if="${userDetails}">
						<i class="fas fa-sign-out-alt"></i>
						Logout
					</a>
					<a class="btn-login" href="/login" th:unless="${userDetails}">
						<i class="fas fa-sign-in-alt"></i>
						Login
					</a>
				</div>
			</div>
		</div>
	</header>

	<main class="form-container">
		<div class="container">
			<div class="form-header">
				<div class="form-icon">
					<i class="fas fa-book-open"></i>
				</div>
				<h1 class="form-title">Ricerca Avanzata Libri</h1>
				<p class="form-subtitle">Trova i libri utilizzando i filtri di ricerca avanzati</p>
			</div>

			<div class="form-wrapper">
				<form th:action="@{/foundLibri}" method="get" th:object="${filtro}" class="book-form">

					<div class="form-section">
						<h3 class="section-title">
							<i class="fas fa-filter"></i>
							Filtri di Ricerca
						</h3>

						<div class="form-row">
							<div class="form-group full-width">
								<label for="title" class="form-label">
									<i class="fas fa-book"></i>
									Titolo
								</label>
								<input type="text" id="title" th:field="*{title}" class="form-input"
									placeholder="Inserisci il titolo del libro" />
							</div>
						</div>

						<div class="form-row">
							<div class="form-group">
								<label for="annoMin" class="form-label">
									<i class="fas fa-calendar-alt"></i>
									Anno Pubblicazione (da)
								</label>
								<input type="number" id="annoMin" th:field="*{annoMin}" class="form-input"
									placeholder="Es. 1900" min="1000" max="2030" />
							</div>

							<div class="form-group">
								<label for="annoMax" class="form-label">
									<i class="fas fa-calendar-alt"></i>
									Anno Pubblicazione (a)
								</label>
								<input type="number" id="annoMax" th:field="*{annoMax}" class="form-input"
									placeholder="Es. 2024" min="1000" max="2030" />
							</div>
						</div>

						<div class="form-row">
							<div class="form-group">
								<label for="minRating" class="form-label">
									<i class="fas fa-star"></i>
									Voto minimo
								</label>
								<div class="rating-input-wrapper">
									<input type="number" step="0.1" min="1" max="5" id="minRating"
										th:field="*{minRating}" class="form-input rating-input"
										placeholder="1.0 - 5.0" />
									<div class="rating-display">
										<div class="stars" id="star-display">
											<i class="fas fa-star"></i>
											<i class="fas fa-star"></i>
											<i class="fas fa-star"></i>
											<i class="fas fa-star"></i>
											<i class="fas fa-star"></i>
										</div>
										<span class="rating-text" id="rating-text">Seleziona voto</span>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="form-actions">
						<button type="button" class="btn-secondary" onclick="clearForm()">
							<i class="fas fa-eraser"></i>
							Pulisci Filtri
						</button>
						<button type="submit" class="btn-primary">
							<i class="fas fa-search"></i>
							Cerca Libri
						</button>
					</div>

				</form>
			</div>
		</div>
	</main>

	<script>
		// Funzione per pulire tutti i campi del form
		function clearForm() {
			document.getElementById('title').value = '';
			document.getElementById('annoMin').value = '';
			document.getElementById('annoMax').value = '';
			document.getElementById('minRating').value = '';
			updateStarDisplay();
		}

		// Effetti di focus sui campi input
		document.querySelectorAll('.form-input').forEach(input => {
			input.addEventListener('focus', function () {
				this.parentElement.classList.add('focused');
			});

			input.addEventListener('blur', function () {
				this.parentElement.classList.remove('focused');
			});
		});

		// Gestione visualizzazione stelle per il rating
		const ratingInput = document.getElementById('minRating');
		const starDisplay = document.getElementById('star-display');
		const ratingText = document.getElementById('rating-text');

		function updateStarDisplay() {
			const rating = parseFloat(ratingInput.value) || 0;
			const stars = starDisplay.querySelectorAll('i');

			stars.forEach((star, index) => {
				if (index < Math.floor(rating)) {
					star.classList.add('active');
				} else if (index === Math.floor(rating) && rating % 1 >= 0.5) {
					star.classList.add('active');
				} else {
					star.classList.remove('active');
				}
			});

			if (rating > 0) {
				ratingText.textContent = `${rating.toFixed(1)} stelle`;
			} else {
				ratingText.textContent = 'Seleziona voto';
			}
		}

		ratingInput.addEventListener('input', updateStarDisplay);

		// Inizializza la visualizzazione delle stelle al caricamento
		document.addEventListener('DOMContentLoaded', updateStarDisplay);

		// Validazione anni
		document.getElementById('annoMin').addEventListener('change', function () {
			const annoMax = document.getElementById('annoMax');
			if (this.value && annoMax.value && parseInt(this.value) > parseInt(annoMax.value)) {
				annoMax.value = this.value;
			}
		});

		document.getElementById('annoMax').addEventListener('change', function () {
			const annoMin = document.getElementById('annoMin');
			if (this.value && annoMin.value && parseInt(this.value) < parseInt(annoMin.value)) {
				annoMin.value = this.value;
			}
		});
	</script>

</body>

</html>